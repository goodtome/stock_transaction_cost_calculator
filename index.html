<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易手续费计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNzU2NzkzOTgxMTIwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE1MzkiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTE5Mi42ODI0MTcgNjE3LjEzNTUwMmMxMC40OTgwOTggOC42NTIwNTQgMjMuNjI1MDcgMTMuMzE4MzMgMzcuMDQwNjE0IDEzLjMxODMzIDIuMzAwMzkyIDAgNC42MDE4MDgtMC4xMzYxIDYuOTAxMTc3LTAuNDA3Mjc2IDE1Ljc5NDczMS0xLjg5NzIxIDMwLjExOTk5NS0xMC4xODE4OTcgMzkuNzQ4MjgzLTIyLjkxODk4OUwzOTYuODExNTM4IDQ0Ny4zMDA0NDJsMTE5LjkxODE4MyAxMDEuNTI2MzAxYzEyLjE1ODkyNCAxMC4yNzcwNjQgMjcuOTM1MjM2IDE1LjM4NzQ1NSA0My43Njc4MjkgMTMuNDkxMjY5IDE1LjgxMzE1MS0xLjY2NDkxOSAzMC4yNzM0OTEtOS42OTY4NSA0MC4wNTUyNzUtMjIuMzE3Mjg1bDI3NS40MjQ5MS0zNTQuOTQyOTY1YzIuMDEwNzk3LTIuNTkzMDU4IDMuNTk2OTIxLTUuMzgwNTQ0IDUuMTI0NzE3LTguMTY4MDNsNDguMzUwMTk1LTU3LjI1NzA1MmMyNS45MDM5NzMtMzAuNjc5NzQzIDE0Ljc2OTM3OC01MC41OTgzOTgtMjQuNzQ2NjE0LTQ0LjI0ODc4M2wtMjI3Ljg2Nzc3OCAzNi41ODMxOTdjLTM5LjUzNDQxMiA2LjM0OTYxNS00Ny43NDk1MTQgMzMuODE3Mi0xOC4yNjgwNjIgNjEuMDcwOTE0bDQ1LjU2NTc3OCA0Mi4xMDA4NjRMNTQ1LjYyOTkzNSA0MTkuNDA3MTYybC0xMjAuNTU0NjgtMTAyLjA4NjA1Yy0xMi4yNzU1ODEtMTAuMzM2NDE2LTI4LjE0NzA2LTE1LjIxNTU0LTQ0LjE5MjUwMS0xMy40NTIzODMtMTUuOTMwODMxIDEuNzgwNTUzLTMwLjQ0ODQ3NiAxMC4wODM2NTktNDAuMTM0MDY5IDIyLjk1NTgyOGwtMTIwLjk2MDkzMiAxNjAuNTI2MDQzLTU4LjA5MzA5My00Ny43OTI0OTNjLTI1LjAxNDcyLTIwLjU5NTA2MS02MS45MDE4MzktMTYuOTE3Mjk4LTgyLjM1NDY2IDguMjg0Njg3LTIwLjQ1MjgyMSAyNS4xNjMwOTktMTYuNzgwMTc1IDYyLjI1MDc4NiA4LjI1NTAxMSA4Mi44MDc5ODRMMTkyLjY4MjQxNyA2MTcuMTM1NTAyeiIgZmlsbD0iI0Y0NTk0NCIgcC1pZD0iMTU0MCI+PC9wYXRoPjxwYXRoIGQ9Ik04NzguNjI2MDUyIDM0OS4yNTk1MjIgNjEwLjAyNTU3MSA2NzYuMzI3NjI2Yy0xMi4wNjM3NTcgMTUuMjkxMjY1LTQyLjc0NDUyMy02LjY1ODY1My01Ny41NTE3NjQtMTkuMjQwMjAzbC0xMDcuOTUxNjQxLTk0Ljk2NDg2MmMtMTQuODA4MjY0LTEyLjU4MDUyNi0zNy4wMDA3MDYgOC43MTAzODItNDkuMzE1MTcyIDIzLjgwOTI2NWwtMTI1LjQ0NzEwNyAxNTMuODg0Nzg2Yy0xMi4yOTQwMDEgMTUuMDk4ODgzLTM0LjQxMTc0MS0yLjIwNjI0OC00OS4xMDMzNDgtMTQuOTI0OTIxbC0xMDkuNDU3OTQ4LTg3LjA0NjUxOGMtMTkuNjQxMzM5LTE4Ljg5MTI1Ni0zOC4zNzUwMDYgMC44MTM1MjgtMzguMzc1MDA2IDM4LjQ4MTQzbDAuNjc2NDA1IDIzMy4xMzE2NjVjMC4wMzc4NjIgMTkuNTUwMjY1IDE1LjkyODc4NCAzNS41Mzg0MDEgMzUuMjgwNTI4IDM1LjU1Nzg0NGw4MTAuNTU4NzkzIDAuNjM5NTY2YzE5LjM3MTE4NiAwLjAxODQyIDM1LjIwMzc4LTE1Ljk2OTcxNyAzNS4yMDM3OC0zNS41MTk5ODEgMCAwIDAuODExNDgyLTUwMy40NDYxODMgMC44MTE0ODItNTQxLjY1NjQzN0M5NTUuMzc1MDQgMzE3LjI0MzM0MSA5MTQuOTEyNDg5IDMwNy40MTAzOTIgODc4LjYyNjA1MiAzNDkuMjU5NTIyeiIgZmlsbD0iI0Y0NTk0NCIgcC1pZD0iMTU0MSI+PC9wYXRoPjwvc3ZnPg==" />
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        success: '#52C41A',
                        danger: '#FF4D4F',
                        warning: '#FAAD14',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary;
            }
            .btn-hover {
                @apply hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300;
            }
            .result-item {
                @apply flex justify-between py-2 border-b border-gray-100 last:border-0;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <!-- 顶部导航 -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-calculator text-primary text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-dark">交易手续费计算器</h1>
            </div>
            <div class="hidden md:flex items-center space-x-4 flex-wrap">
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-500"><i class="fa fa-info-circle mr-1"></i> 佣金:</span>
                    <select id="commission-rate" class="text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <option value="0.013">0.013%（万1.3）</option>
                        <option value="0.01">0.01%（万1）</option>
                        <option value="0.03">0.03%（万3）</option>
                        <option value="custom">自定义</option>
                    </select>
                    <input type="number" id="custom-commission" step="0.001" min="0.001" max="1" class="text-sm border border-gray-300 rounded px-2 py-1 w-20 focus:ring-2 focus:ring-primary/50 focus:border-primary hidden" placeholder="0.013">
                    <span class="text-sm text-gray-500">（最低0.5元）</span>
                </div>
                <span class="text-sm text-gray-500"><i class="fa fa-info-circle mr-1"></i> 印花税: 0.05%（股票卖出）</span>
                <span class="text-sm text-gray-500"><i class="fa fa-info-circle mr-1"></i> 过户费: 0.001%（股票）/0.0001元/份（ETF）</span>
                <div class="flex items-center space-x-2 ml-4">
                    <span class="text-sm text-gray-500"><i class="fa fa-info-circle mr-1"></i> 最低佣金:</span>
                    <select id="min-commission-type" class="text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <option value="0.5">最低0.5元</option>
                        <option value="none">免最低</option>
                        <option value="5">最低5元</option>
                        <option value="custom">自定义最低</option>
                    </select>
                    <input type="number" id="custom-min-commission" step="0.01" min="0" class="text-sm border border-gray-300 rounded px-2 py-1 w-20 focus:ring-2 focus:ring-primary/50 focus:border-primary hidden" placeholder="0.5">
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- 说明卡片 -->
        <div class="bg-primary/5 rounded-lg p-4 mb-8 border border-primary/20">
            <div class="flex items-start">
                <i class="fa fa-lightbulb-o text-primary mt-1 mr-3 text-xl"></i>
                <div>
                    <h2 class="font-semibold text-dark mb-2">使用说明</h2>
                    <p class="text-sm text-gray-600">本计算器支持股票和ETF交易的费用和收益计算。ETF交易不收取印花税，过户费按份额计算（0.0001元/份）。所有费率已按您提供的参数预设。</p>
                </div>
            </div>
        </div>

        <!-- 选项卡导航 -->
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-nowrap -mb-px" id="calculator-tabs" role="tablist">
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-primary text-primary rounded-t-lg" id="buy-tab" data-tabs-target="#buy-calculator" type="button" role="tab" aria-selected="true">
                        <i class="fa fa-arrow-down mr-2"></i>买入手续费
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="sell-tab" data-tabs-target="#sell-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-arrow-up mr-2"></i>卖出手续费
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="profit-tab" data-tabs-target="#profit-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-line-chart mr-2"></i>股票获利
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="etf-profit-tab" data-tabs-target="#etf-profit-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-exchange mr-2"></i>ETF获利
                    </button>
                </li>
                <li role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="t-tab" data-tabs-target="#t-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-refresh mr-2"></i>做T交易
                    </button>
                </li>
                <li role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="tbe-tab" data-tabs-target="#tbe-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-life-ring mr-2"></i>做T回本
                    </button>
                </li>
                <li role="presentation">
                    <button class="inline-block py-4 px-5 text-sm font-medium text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 rounded-t-lg" id="rtpl-tab" data-tabs-target="#realtime-pl-calculator" type="button" role="tab" aria-selected="false">
                        <i class="fa fa-bolt mr-2"></i>行情盈亏
                    </button>
                </li>
            </ul>
        </div>

        <!-- 计算器内容 -->
        <div id="calculator-content">
            <!-- 买入手续费计算器 -->
            <div class="block p-6 bg-white rounded-lg shadow card-shadow" id="buy-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-arrow-down text-success mr-2"></i>买入手续费计算
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">品种类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="buy-type" value="stock" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">股票</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="buy-type" value="etf" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">ETF</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="buy-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="buy-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="buy-price" class="block text-sm font-medium text-gray-700 mb-1">价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="buy-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="buy-shares" class="block text-sm font-medium text-gray-700 mb-1">买入数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="buy-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入买入数量（100的倍数）">
                        </div>
                        
                        <div class="mt-6">
                            <button id="calculate-buy" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算买入费用
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="buy-results" class="space-y-3 text-gray-700">
                            <div class="result-item">
                                <span>总价值：</span>
                                <span id="buy-total-price" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>佣金：</span>
                                <span id="buy-commission" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>过户费：</span>
                                <span id="buy-transfer-fee" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">手续费合计：</span>
                                <span id="buy-fees-total" class="font-semibold text-warning">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">买入总成本：</span>
                                <span id="buy-total-cost" class="font-semibold text-primary">- -</span>
                            </div>
                            <div class="result-item">
                                <span>每股/每份成本价：</span>
                                <span id="buy-cost-per-share" class="font-medium text-success">- -</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 卖出手续费计算器 -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="sell-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-arrow-up text-danger mr-2"></i>卖出手续费计算
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">品种类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="sell-type" value="stock" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">股票</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="sell-type" value="etf" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">ETF</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="sell-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="sell-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="sell-price" class="block text-sm font-medium text-gray-700 mb-1">价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="sell-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="sell-shares" class="block text-sm font-medium text-gray-700 mb-1">卖出数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="sell-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入卖出数量（100的倍数）">
                        </div>
                        
                        <div class="mt-6">
                            <button id="calculate-sell" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算卖出费用
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="sell-results" class="space-y-3 text-gray-700">
                            <div class="result-item">
                                <span>总价值：</span>
                                <span id="sell-total-value" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>佣金：</span>
                                <span id="sell-commission" class="font-medium">- -</span>
                            </div>
                            <div class="result-item" id="sell-stamp-duty-container">
                                <span>印花税：</span>
                                <span id="sell-stamp-duty" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>过户费：</span>
                                <span id="sell-transfer-fee" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">手续费合计：</span>
                                <span id="sell-fees-total" class="font-semibold text-warning">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">卖出实际到账：</span>
                                <span id="sell-actual-amount" class="font-semibold text-primary">- -</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 股票买卖获利计算器 -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="profit-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-line-chart text-warning mr-2"></i>股票买卖获利计算
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="profit-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="profit-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="buy-price-profit" class="block text-sm font-medium text-gray-700 mb-1">买入价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="buy-price-profit" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入买入价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="sell-price-profit" class="block text-sm font-medium text-gray-700 mb-1">卖出价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="sell-price-profit" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入卖出价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="shares-profit" class="block text-sm font-medium text-gray-700 mb-1">股票数量 (股)</label>
                            <input type="number" step="100" min="100" id="shares-profit" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入股票数量（100股的倍数）">
                        </div>
                        
                        <div class="mt-6">
                            <button id="calculate-profit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算获利
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="profit-results" class="space-y-3 text-gray-700">
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">买入费用明细</h4>
                                <div class="result-item">
                                    <span>股票总价：</span>
                                    <span id="profit-buy-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入佣金：</span>
                                    <span id="profit-buy-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入过户费：</span>
                                    <span id="profit-buy-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">买入总成本：</span>
                                    <span id="profit-total-buy-cost" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">卖出费用明细</h4>
                                <div class="result-item">
                                    <span>股票总价值：</span>
                                    <span id="profit-sell-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出佣金：</span>
                                    <span id="profit-sell-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>印花税：</span>
                                    <span id="profit-stamp-duty" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出过户费：</span>
                                    <span id="profit-sell-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">卖出实际到账：</span>
                                    <span id="profit-total-sell-amount" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">收益 summary</h4>
                                <div class="result-item">
                                    <span>总交易费用：</span>
                                    <span id="profit-total-transaction-fees" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">净利润：</span>
                                    <span id="profit-net-profit" class="font-semibold text-success">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">收益率：</span>
                                    <span id="profit-profit-rate" class="font-semibold text-primary">- -</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ETF买卖获利计算器 -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="etf-profit-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-exchange text-secondary mr-2"></i>ETF买卖获利计算
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="etf-profit-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="etf-profit-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="etf-buy-price" class="block text-sm font-medium text-gray-700 mb-1">买入价格 (元)</label>
                            <input type="number" step="0.001" min="0.001" id="etf-buy-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入买入价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="etf-sell-price" class="block text-sm font-medium text-gray-700 mb-1">卖出价格 (元)</label>
                            <input type="number" step="0.001" min="0.001" id="etf-sell-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入卖出价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="etf-shares" class="block text-sm font-medium text-gray-700 mb-1">ETF数量 (份)</label>
                            <input type="number" step="100" min="100" id="etf-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入ETF数量（100份的倍数）">
                        </div>
                        
                        <div class="mt-6">
                            <button id="calculate-etf-profit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算ETF获利
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="etf-profit-results" class="space-y-3 text-gray-700">
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">买入费用明细</h4>
                                <div class="result-item">
                                    <span>ETF总价值：</span>
                                    <span id="etf-buy-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入佣金：</span>
                                    <span id="etf-buy-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入过户费：</span>
                                    <span id="etf-buy-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">买入总成本：</span>
                                    <span id="etf-total-buy-cost" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">卖出费用明细</h4>
                                <div class="result-item">
                                    <span>ETF总价值：</span>
                                    <span id="etf-sell-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出佣金：</span>
                                    <span id="etf-sell-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出过户费：</span>
                                    <span id="etf-sell-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">卖出实际到账：</span>
                                    <span id="etf-total-sell-amount" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">收益 summary</h4>
                                <div class="result-item">
                                    <span>总交易费用：</span>
                                    <span id="etf-total-transaction-fees" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">净利润：</span>
                                    <span id="etf-net-profit" class="font-semibold text-success">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">收益率：</span>
                                    <span id="etf-profit-rate" class="font-semibold text-primary">- -</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 做T交易计算器 -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="t-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-refresh text-secondary mr-2"></i>做T交易计算
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">品种类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="t-type" value="stock" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">股票</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="t-type" value="etf" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">ETF</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="t-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="t-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="original-cost" class="block text-sm font-medium text-gray-700 mb-1">原有持仓成本价 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="original-cost" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入原有持仓成本价">
                        </div>
                        
                        <div class="mb-4">
                            <label for="original-shares" class="block text-sm font-medium text-gray-700 mb-1">原有持仓数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="original-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入原有持仓数量">
                        </div>
                        
                        <div class="mb-4">
                            <label for="t-buy-price" class="block text-sm font-medium text-gray-700 mb-1">做T买入价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="t-buy-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入做T买入价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="t-sell-price" class="block text-sm font-medium text-gray-700 mb-1">做T卖出价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="t-sell-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入做T卖出价格">
                        </div>
                        
                        <div class="mb-4">
                            <label for="t-shares" class="block text-sm font-medium text-gray-700 mb-1">做T数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="t-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入做T数量（100的倍数）">
                        </div>
                        
                        <div class="mt-6">
                            <button id="calculate-t" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算做T结果
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="t-results" class="space-y-3 text-gray-700">
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">做T买入费用明细</h4>
                                <div class="result-item">
                                    <span>买入总价：</span>
                                    <span id="t-buy-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入佣金：</span>
                                    <span id="t-buy-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>买入过户费：</span>
                                    <span id="t-buy-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">买入总成本：</span>
                                    <span id="t-buy-cost" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">做T卖出费用明细</h4>
                                <div class="result-item">
                                    <span>卖出总价：</span>
                                    <span id="t-sell-total" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出佣金：</span>
                                    <span id="t-sell-commission" class="font-medium">- -</span>
                                </div>
                                <div class="result-item" id="t-stamp-duty-container">
                                    <span>印花税：</span>
                                    <span id="t-stamp-duty" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>卖出过户费：</span>
                                    <span id="t-sell-transfer" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">卖出实际收入：</span>
                                    <span id="t-sell-income" class="font-semibold">- -</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-500 mb-2">做T收益 summary</h4>
                                <div class="result-item">
                                    <span>做T交易总费用：</span>
                                    <span id="t-transaction-fees" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">做T获利：</span>
                                    <span id="t-profit" class="font-semibold text-success">- -</span>
                                </div>
                                <div class="result-item">
                                    <span>原持仓成本价：</span>
                                    <span id="pre-t-cost" class="font-medium">- -</span>
                                </div>
                                <div class="result-item">
                                    <span class="font-semibold">做T后成本价：</span>
                                    <span id="post-t-cost" class="font-semibold text-primary">- -</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 做T回本计算器 -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="tbe-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-life-ring text-secondary mr-2"></i>做T回本计算
                </h2>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">品种类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tbe-type" value="stock" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">股票</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tbe-type" value="etf" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">ETF</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">市场类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tbe-market" value="sh" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">沪市</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tbe-market" value="sz" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">深市</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="tbe-original-cost" class="block text-sm font-medium text-gray-700 mb-1">原有持仓成本价 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="tbe-original-cost" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入原有持仓成本价">
                        </div>

                        <div class="mb-4">
                            <label for="tbe-original-shares" class="block text-sm font-medium text-gray-700 mb-1">原有持仓数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="tbe-original-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入原有持仓数量（100的倍数）">
                        </div>

                        <div class="mb-4">
                            <label for="tbe-current-price" class="block text-sm font-medium text-gray-700 mb-1">当前价格 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="tbe-current-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="用于计算浮亏">
                        </div>

                        <div class="mb-4">
                            <label for="tbe-buy-price" class="block text-sm font-medium text-gray-700 mb-1">每轮做T买入价 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="tbe-buy-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="计划买入价">
                        </div>

                        <div class="mb-4">
                            <label for="tbe-sell-price" class="block text-sm font-medium text-gray-700 mb-1">每轮做T卖出价 (元)</label>
                            <input type="number" step="0.01" min="0.01" id="tbe-sell-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="计划卖出价">
                        </div>

                        <div class="mb-4">
                            <label for="tbe-shares" class="block text-sm font-medium text-gray-700 mb-1">每轮做T数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="tbe-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="每轮数量（100的倍数）">
                        </div>

                        <!-- 高级策略 -->
                        <div class="mb-2 pt-2 border-t border-gray-200">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="tbe-adv-enabled" class="h-4 w-4 text-primary focus:ring-primary">
                                <span class="ml-2 text-sm font-medium text-gray-700">启用高级策略（动态数量 / 滑点 / 阶梯价差）</span>
                            </label>
                        </div>

                        <div id="tbe-adv-container" class="space-y-3 hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">数量模式</label>
                                    <select id="tbe-qty-mode" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus">
                                        <option value="fixed" selected>固定数量</option>
                                        <option value="inc">每轮+增量</option>
                                        <option value="dec">每轮-减量</option>
                                        <option value="incPct">每轮+增幅%</option>
                                        <option value="decPct">每轮-减幅%</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">最大轮数</label>
                                    <input type="number" id="tbe-adv-max-rounds" min="1" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="如 100">
                                </div>
                            </div>

                            <div id="tbe-qty-inc-row" class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">步进（股/份）</label>
                                    <input type="number" id="tbe-adv-inc" step="100" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="每轮±多少">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">下限（股/份）</label>
                                    <input type="number" id="tbe-adv-min" step="100" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="可留空">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">上限（股/份）</label>
                                    <input type="number" id="tbe-adv-max" step="100" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="可留空">
                                </div>
                            </div>

                            <div id="tbe-qty-incpct-row" class="grid grid-cols-1 md:grid-cols-3 gap-3 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">增减幅（%）</label>
                                    <input type="number" id="tbe-adv-inc-pct" step="0.1" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="每轮±%">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">下限（股/份）</label>
                                    <input type="number" id="tbe-adv-min-pct" step="100" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="可留空">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">上限（股/份）</label>
                                    <input type="number" id="tbe-adv-max-pct" step="100" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="可留空">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">买入滑点（元）</label>
                                    <input type="number" id="tbe-adv-buy-slip" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="成交价上浮">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">卖出滑点（元）</label>
                                    <input type="number" id="tbe-adv-sell-slip" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="成交价下浮">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">买入阶梯步长（元/轮）</label>
                                    <input type="number" id="tbe-adv-buy-step" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="每轮买价递减">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">卖出阶梯步长（元/轮）</label>
                                    <input type="number" id="tbe-adv-sell-step" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus" placeholder="每轮卖价递增">
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <button id="calculate-tbe" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>计算回本轮数
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="tbe-results" class="space-y-3 text-gray-700">
                            <div class="result-item">
                                <span>原总成本：</span>
                                <span id="tbe-original-total" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>当前总市值：</span>
                                <span id="tbe-current-value" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>需要弥补的浮亏：</span>
                                <span id="tbe-loss-to-cover" class="font-medium text-danger">- -</span>
                            </div>
                            <div class="result-item">
                                <span>每轮净收益：</span>
                                <span id="tbe-profit-per-round" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">预计需要轮数：</span>
                                <span id="tbe-rounds" class="font-semibold text-primary">- -</span>
                            </div>
                            <div class="result-item">
                                <span>累计净收益：</span>
                                <span id="tbe-total-profit" class="font-medium text-success">- -</span>
                            </div>
                            <div class="result-item">
                                <span>累计总费用：</span>
                                <span id="tbe-total-fees" class="font-medium">- -</span>
                            </div>
                            <div class="result-item" id="tbe-stamp-duty-container">
                                <span>每轮卖出印花税（股票）：</span>
                                <span id="tbe-stamp-duty-per-round" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">回本后预估成本价：</span>
                                <span id="tbe-post-cost" class="font-semibold text-primary">- -</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 行情盈亏（代码/名称→最新价） -->
            <div class="hidden p-6 bg-white rounded-lg shadow card-shadow" id="realtime-pl-calculator" role="tabpanel">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa fa-bolt text-warning mr-2"></i>行情盈亏（最新价）
                </h2>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">股票代码或名称</label>
                            <div class="relative">
                                <input type="text" id="rt-symbol" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="如 600000 / 平安银行">
                                <div id="rt-suggest" class="absolute z-20 mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg hidden max-h-60 overflow-auto"></div>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">支持输入代码或名称，选择联想项后计算。</p>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">品种类型</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="rt-type" value="stock" checked class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">股票</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="rt-type" value="etf" class="text-primary focus:ring-primary h-4 w-4">
                                    <span class="ml-2 text-sm text-gray-700">ETF</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="rt-cost" class="block text-sm font-medium text-gray-700 mb-1">持仓成本价 (元/股)</label>
                            <input type="number" step="0.01" min="0.01" id="rt-cost" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="每股成本（建议含买入费用）">
                        </div>

                        <div class="mb-4">
                            <label for="rt-shares" class="block text-sm font-medium text-gray-700 mb-1">持仓数量 (股/份)</label>
                            <input type="number" step="100" min="100" id="rt-shares" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition duration-200" placeholder="输入数量（100的倍数）">
                        </div>

                        <div class="mt-6">
                            <button id="calculate-rtpl" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium btn-hover flex items-center justify-center">
                                <i class="fa fa-calculator mr-2"></i>查询最新价并计算
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">计算结果</h3>
                        <div id="rtpl-results" class="space-y-3 text-gray-700">
                            <div class="result-item">
                                <span>证券信息：</span>
                                <span id="rtpl-info" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>最新价：</span>
                                <span id="rtpl-last" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>昨收：</span>
                                <span id="rtpl-prev" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>涨跌幅：</span>
                                <span id="rtpl-chg" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>卖出佣金：</span>
                                <span id="rtpl-commission" class="font-medium">- -</span>
                            </div>
                            <div class="result-item" id="rtpl-stamp-duty-container">
                                <span>印花税：</span>
                                <span id="rtpl-stamp" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span>过户费：</span>
                                <span id="rtpl-transfer" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">卖出实际到账：</span>
                                <span id="rtpl-actual" class="font-semibold">- -</span>
                            </div>
                            <div class="result-item">
                                <span>原总成本（按持仓成本）：</span>
                                <span id="rtpl-orig" class="font-medium">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">净盈亏：</span>
                                <span id="rtpl-net" class="font-semibold">- -</span>
                            </div>
                            <div class="result-item">
                                <span class="font-semibold">收益率：</span>
                                <span id="rtpl-rate" class="font-semibold">- -</span>
                            </div>
                            <div class="text-xs text-gray-400">提示：默认认为持仓成本已包含买入费用，仅计算卖出侧费用。</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white mt-12 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fa fa-calculator text-primary mr-2"></i>
                        <span class="font-bold">交易手续费计算器</span>
                    </div>
                    <p class="text-sm text-gray-400 mt-2">专业、精准的股票和ETF交易费用计算工具</p>
                </div>
                
                <div class="text-sm text-gray-400">
                    <p>费率说明：佣金 0.013%（可设置最低佣金） | 印花税 0.05%（股票卖出） | 过户费 0.001%（股票）/0.0001元/份（ETF）</p>
                    <p class="mt-1">© 2025 交易手续费计算器 - 保留所有权利</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 费率设置
        const STAMP_DUTY_RATE = 0.05 / 100;    // 印花税率（股票卖出）
        const STOCK_TRANSFER_RATE = 0.001 / 100; // 股票过户费率
        const ETF_TRANSFER_FEE_PER_SHARE = 0.0001; // ETF过户费（元/份）
        const BASE_MIN_COMMISSION = 0.5;              // 基础最低佣金

        // 获取当前佣金率
        function getCommissionRate() {
            const selectEl = document.getElementById('commission-rate');
            const customEl = document.getElementById('custom-commission');
            
            if (selectEl.value === 'custom') {
                const customRate = parseFloat(customEl.value);
                if (isNaN(customRate) || customRate <= 0 || customRate > 1) {
                    return 0.013 / 100; // 默认值
                }
                return customRate / 100;
            } else {
                return parseFloat(selectEl.value) / 100;
            }
        }

        // 获取最低佣金设置
        function getMinCommission() {
            const selectEl = document.getElementById('min-commission-type');
            const customEl = document.getElementById('custom-min-commission');
            
            if (selectEl.value === 'custom') {
                const customMin = parseFloat(customEl.value);
                if (isNaN(customMin) || customMin < 0) {
                    return 0.5; // 默认值
                }
                return customMin;
            } else if (selectEl.value === 'none') {
                return 0;
            } else {
                return parseFloat(selectEl.value);
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化品种类型切换事件
            initTypeToggleEvents();
            
            // 初始化佣金率选择事件
            initCommissionRateEvents();
            
            // 初始化最低佣金选择事件
            initMinCommissionEvents();
        });
        
        // 初始化佣金率选择事件
        function initCommissionRateEvents() {
            const selectEl = document.getElementById('commission-rate');
            const customEl = document.getElementById('custom-commission');
            
            selectEl.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customEl.classList.remove('hidden');
                    customEl.focus();
                } else {
                    customEl.classList.add('hidden');
                }
            });
            
            customEl.addEventListener('input', function() {
                // 实时验证自定义佣金率
                const rate = parseFloat(this.value);
                if (!isNaN(rate) && rate > 0 && rate <= 1) {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-gray-300');
                } else {
                    this.classList.remove('border-gray-300');
                    this.classList.add('border-red-500');
                }
            });
        }
        
        // 初始化最低佣金选择事件
        function initMinCommissionEvents() {
            const selectEl = document.getElementById('min-commission-type');
            const customEl = document.getElementById('custom-min-commission');
            
            selectEl.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customEl.classList.remove('hidden');
                    customEl.focus();
                } else {
                    customEl.classList.add('hidden');
                }
            });
            
            customEl.addEventListener('input', function() {
                // 实时验证自定义最低佣金
                const minCommission = parseFloat(this.value);
                if (!isNaN(minCommission) && minCommission >= 0) {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-gray-300');
                } else {
                    this.classList.remove('border-gray-300');
                    this.classList.add('border-red-500');
                }
            });
        }
        
        // 初始化品种类型切换事件
        function initTypeToggleEvents() {
            // 卖出计算器的品种类型切换
            document.querySelectorAll('input[name="sell-type"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const stampDutyContainer = document.getElementById('sell-stamp-duty-container');
                    if (this.value === 'etf') {
                        stampDutyContainer.style.display = 'none';
                    } else {
                        stampDutyContainer.style.display = 'flex';
                    }
                });
            });
            
            // 做T计算器的品种类型切换
            document.querySelectorAll('input[name="t-type"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const stampDutyContainer = document.getElementById('t-stamp-duty-container');
                    if (this.value === 'etf') {
                        stampDutyContainer.style.display = 'none';
                    } else {
                        stampDutyContainer.style.display = 'flex';
                    }
                });
            });
            
            // 初始隐藏ETF相关的印花税项
            if (document.querySelector('input[name="sell-type"][value="etf"]').checked) {
                document.getElementById('sell-stamp-duty-container').style.display = 'none';
            }
            
            if (document.querySelector('input[name="t-type"][value="etf"]').checked) {
                document.getElementById('t-stamp-duty-container').style.display = 'none';
            }

            // 初始隐藏做T回本的印花税项（当选择ETF时）
            const tbeEtfRadio = document.querySelector('input[name="tbe-type"][value="etf"]');
            if (tbeEtfRadio && tbeEtfRadio.checked) {
                const tbeStamp = document.getElementById('tbe-stamp-duty-container');
                if (tbeStamp) tbeStamp.style.display = 'none';
            }
        }
        
        // 选项卡切换功能
        document.querySelectorAll('#calculator-tabs button').forEach(button => {
            button.addEventListener('click', () => {
                // 移除所有选项卡的活跃状态
                document.querySelectorAll('#calculator-tabs button').forEach(btn => {
                    btn.classList.remove('border-primary', 'text-primary');
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.setAttribute('aria-selected', 'false');
                });
                
                // 设置当前选项卡为活跃状态
                button.classList.remove('border-transparent', 'text-gray-500');
                button.classList.add('border-primary', 'text-primary');
                button.setAttribute('aria-selected', 'true');
                
                // 隐藏所有内容区域
                document.querySelectorAll('#calculator-content > div').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // 显示当前选项卡对应的内容
                const target = button.getAttribute('data-tabs-target');
                document.querySelector(target).classList.remove('hidden');
            });
        });

        // 做T回本：品种切换时印花税显隐
        document.querySelectorAll('input[name="tbe-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const c = document.getElementById('tbe-stamp-duty-container');
                if (!c) return;
                c.style.display = this.value === 'etf' ? 'none' : 'flex';
            });
        });

        // 高级策略显隐与数量模式行显隐
        const advEnabled = document.getElementById('tbe-adv-enabled');
        const advContainer = document.getElementById('tbe-adv-container');
        const qtyMode = document.getElementById('tbe-qty-mode');
        const rowInc = document.getElementById('tbe-qty-inc-row');
        const rowIncpct = document.getElementById('tbe-qty-incpct-row');
        if (advEnabled) {
            advEnabled.addEventListener('change', () => {
                advContainer.classList.toggle('hidden', !advEnabled.checked);
            });
        }
        if (qtyMode) {
            qtyMode.addEventListener('change', () => {
                const mode = qtyMode.value;
                const pct = mode === 'incPct' || mode === 'decPct';
                rowInc.classList.toggle('hidden', pct);
                rowIncpct.classList.toggle('hidden', !pct);
            });
        }
        
        // 格式化金额为人民币格式
        function formatCurrency(amount) {
            return '¥' + amount.toFixed(2);
        }
        
        // 格式化百分比
        function formatPercentage(rate) {
            return (rate * 100).toFixed(2) + '%';
        }
        
        // 获取选中的市场类型
        function getSelectedMarket(prefix) {
            const marketElements = document.querySelectorAll(`input[name="${prefix}-market"]`);
            for (const el of marketElements) {
                if (el.checked) {
                    return el.value;
                }
            }
            return 'sh'; // 默认沪市
        }
        
        // 获取选中的品种类型
        function getSelectedType(prefix) {
            const typeElements = document.querySelectorAll(`input[name="${prefix}-type"]`);
            for (const el of typeElements) {
                if (el.checked) {
                    return el.value;
                }
            }
            return 'stock'; // 默认股票
        }
        
        // 计算买入手续费
        document.getElementById('calculate-buy').addEventListener('click', () => {
            const type = getSelectedType('buy');
            const market = getSelectedMarket('buy');
            const price = parseFloat(document.getElementById('buy-price').value);
            const shares = parseInt(document.getElementById('buy-shares').value);
            
            if (isNaN(price) || isNaN(shares) || price <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的价格和数量（数量应为100的倍数）');
                return;
            }
            
            // 计算各项费用
            const totalPrice = price * shares;
            let commission = totalPrice * getCommissionRate();
            commission = Math.max(commission, getMinCommission()); // 佣金不低于最低标准（可免5）
            
            // 计算过户费（股票和ETF计算方式不同）
            let transferFee = 0;
            if (market === 'sh') { // 深市无过户费
                if (type === 'stock') {
                    transferFee = totalPrice * STOCK_TRANSFER_RATE;
                } else { // ETF
                    transferFee = shares * ETF_TRANSFER_FEE_PER_SHARE;
                }
            }
            
            const feesTotal = commission + transferFee;
            const totalCost = totalPrice + feesTotal;
            const costPerShare = totalCost / shares;
            
            // 显示结果
            document.getElementById('buy-total-price').textContent = formatCurrency(totalPrice);
            document.getElementById('buy-commission').textContent = formatCurrency(commission);
            document.getElementById('buy-transfer-fee').textContent = formatCurrency(transferFee);
            document.getElementById('buy-fees-total').textContent = formatCurrency(feesTotal);
            document.getElementById('buy-total-cost').textContent = formatCurrency(totalCost);
            document.getElementById('buy-cost-per-share').textContent = costPerShare.toFixed(4) + '元';
            
            // 添加动画效果
            animateResults('buy-results');
        });
        
        // 计算卖出手续费
        document.getElementById('calculate-sell').addEventListener('click', () => {
            const type = getSelectedType('sell');
            const market = getSelectedMarket('sell');
            const price = parseFloat(document.getElementById('sell-price').value);
            const shares = parseInt(document.getElementById('sell-shares').value);
            
            if (isNaN(price) || isNaN(shares) || price <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的价格和数量（数量应为100的倍数）');
                return;
            }
            
            // 计算各项费用
            const totalValue = price * shares;
            let commission = totalValue * getCommissionRate();
            commission = Math.max(commission, getMinCommission()); // 佣金不低于最低标准（可免5）
            
            // 股票卖出有印花税，ETF没有
            const stampDuty = type === 'stock' ? totalValue * STAMP_DUTY_RATE : 0;
            
            // 计算过户费（股票和ETF计算方式不同）
            let transferFee = 0;
            if (market === 'sh') { // 深市无过户费
                if (type === 'stock') {
                    transferFee = totalValue * STOCK_TRANSFER_RATE;
                } else { // ETF
                    transferFee = shares * ETF_TRANSFER_FEE_PER_SHARE;
                }
            }
            
            const feesTotal = commission + stampDuty + transferFee;
            const actualAmount = totalValue - feesTotal;
            
            // 显示结果
            document.getElementById('sell-total-value').textContent = formatCurrency(totalValue);
            document.getElementById('sell-commission').textContent = formatCurrency(commission);
            document.getElementById('sell-stamp-duty').textContent = formatCurrency(stampDuty);
            document.getElementById('sell-transfer-fee').textContent = formatCurrency(transferFee);
            document.getElementById('sell-fees-total').textContent = formatCurrency(feesTotal);
            document.getElementById('sell-actual-amount').textContent = formatCurrency(actualAmount);
            
            // 添加动画效果
            animateResults('sell-results');
        });
        
        // 计算股票买卖获利
        document.getElementById('calculate-profit').addEventListener('click', () => {
            const market = getSelectedMarket('profit');
            const buyPrice = parseFloat(document.getElementById('buy-price-profit').value);
            const sellPrice = parseFloat(document.getElementById('sell-price-profit').value);
            const shares = parseInt(document.getElementById('shares-profit').value);
            
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(shares) || 
                buyPrice <= 0 || sellPrice <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的股票价格和数量（数量应为100的倍数）');
                return;
            }
            
            // 计算买入成本
            const buyTotalPrice = buyPrice * shares;
            let buyCommission = buyTotalPrice * getCommissionRate();
            buyCommission = Math.max(buyCommission, getMinCommission());
            const buyTransferFee = market === 'sh' ? buyTotalPrice * STOCK_TRANSFER_RATE : 0;
            const totalBuyCost = buyTotalPrice + buyCommission + buyTransferFee;
            
            // 计算卖出收入
            const sellTotalValue = sellPrice * shares;
            let sellCommission = sellTotalValue * getCommissionRate();
            sellCommission = Math.max(sellCommission, getMinCommission());
            const stampDuty = sellTotalValue * STAMP_DUTY_RATE;
            const sellTransferFee = market === 'sh' ? sellTotalValue * STOCK_TRANSFER_RATE : 0;
            const totalSellAmount = sellTotalValue - sellCommission - stampDuty - sellTransferFee;
            
            // 计算利润
            const totalTransactionFees = buyCommission + buyTransferFee + sellCommission + stampDuty + sellTransferFee;
            const netProfit = totalSellAmount - totalBuyCost;
            const profitRate = netProfit / totalBuyCost;
            
            // 显示结果
            document.getElementById('profit-buy-total').textContent = formatCurrency(buyTotalPrice);
            document.getElementById('profit-buy-commission').textContent = formatCurrency(buyCommission);
            document.getElementById('profit-buy-transfer').textContent = formatCurrency(buyTransferFee);
            document.getElementById('profit-total-buy-cost').textContent = formatCurrency(totalBuyCost);
            
            document.getElementById('profit-sell-total').textContent = formatCurrency(sellTotalValue);
            document.getElementById('profit-sell-commission').textContent = formatCurrency(sellCommission);
            document.getElementById('profit-stamp-duty').textContent = formatCurrency(stampDuty);
            document.getElementById('profit-sell-transfer').textContent = formatCurrency(sellTransferFee);
            document.getElementById('profit-total-sell-amount').textContent = formatCurrency(totalSellAmount);
            
            document.getElementById('profit-total-transaction-fees').textContent = formatCurrency(totalTransactionFees);
            
            // 根据利润正负显示不同颜色
            const profitElement = document.getElementById('profit-net-profit');
            profitElement.textContent = formatCurrency(netProfit);
            if (netProfit >= 0) {
                profitElement.className = 'font-semibold text-success';
            } else {
                profitElement.className = 'font-semibold text-danger';
            }
            
            // 显示收益率
            const rateElement = document.getElementById('profit-profit-rate');
            rateElement.textContent = formatPercentage(profitRate);
            if (profitRate >= 0) {
                rateElement.className = 'font-semibold text-success';
            } else {
                rateElement.className = 'font-semibold text-danger';
            }
            
            // 添加动画效果
            animateResults('profit-results');
        });
        
        // 计算ETF买卖获利
        document.getElementById('calculate-etf-profit').addEventListener('click', () => {
            const market = getSelectedMarket('etf-profit');
            const buyPrice = parseFloat(document.getElementById('etf-buy-price').value);
            const sellPrice = parseFloat(document.getElementById('etf-sell-price').value);
            const shares = parseInt(document.getElementById('etf-shares').value);
            
            if (isNaN(buyPrice) || isNaN(sellPrice) || isNaN(shares) || 
                buyPrice <= 0 || sellPrice <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的ETF价格和数量（数量应为100的倍数）');
                return;
            }
            
            // 计算买入成本
            const buyTotalPrice = buyPrice * shares;
            let buyCommission = buyTotalPrice * getCommissionRate();
            buyCommission = Math.max(buyCommission, getMinCommission());
            const buyTransferFee = market === 'sh' ? shares * ETF_TRANSFER_FEE_PER_SHARE : 0;
            const totalBuyCost = buyTotalPrice + buyCommission + buyTransferFee;
            
            // 计算卖出收入（ETF无印花税）
            const sellTotalValue = sellPrice * shares;
            let sellCommission = sellTotalValue * getCommissionRate();
            sellCommission = Math.max(sellCommission, getMinCommission());
            const sellTransferFee = market === 'sh' ? shares * ETF_TRANSFER_FEE_PER_SHARE : 0;
            const totalSellAmount = sellTotalValue - sellCommission - sellTransferFee;
            
            // 计算利润
            const totalTransactionFees = buyCommission + buyTransferFee + sellCommission + sellTransferFee;
            const netProfit = totalSellAmount - totalBuyCost;
            const profitRate = netProfit / totalBuyCost;
            
            // 显示结果
            document.getElementById('etf-buy-total').textContent = formatCurrency(buyTotalPrice);
            document.getElementById('etf-buy-commission').textContent = formatCurrency(buyCommission);
            document.getElementById('etf-buy-transfer').textContent = formatCurrency(buyTransferFee);
            document.getElementById('etf-total-buy-cost').textContent = formatCurrency(totalBuyCost);
            
            document.getElementById('etf-sell-total').textContent = formatCurrency(sellTotalValue);
            document.getElementById('etf-sell-commission').textContent = formatCurrency(sellCommission);
            document.getElementById('etf-sell-transfer').textContent = formatCurrency(sellTransferFee);
            document.getElementById('etf-total-sell-amount').textContent = formatCurrency(totalSellAmount);
            
            document.getElementById('etf-total-transaction-fees').textContent = formatCurrency(totalTransactionFees);
            
            // 根据利润正负显示不同颜色
            const profitElement = document.getElementById('etf-net-profit');
            profitElement.textContent = formatCurrency(netProfit);
            if (netProfit >= 0) {
                profitElement.className = 'font-semibold text-success';
            } else {
                profitElement.className = 'font-semibold text-danger';
            }
            
            // 显示收益率
            const rateElement = document.getElementById('etf-profit-rate');
            rateElement.textContent = formatPercentage(profitRate);
            if (profitRate >= 0) {
                rateElement.className = 'font-semibold text-success';
            } else {
                rateElement.className = 'font-semibold text-danger';
            }
            
            // 添加动画效果
            animateResults('etf-profit-results');
        });
        
        // 计算做T交易
        document.getElementById('calculate-t').addEventListener('click', () => {
            const type = getSelectedType('t');
            const market = getSelectedMarket('t');
            const originalCost = parseFloat(document.getElementById('original-cost').value);
            const originalShares = parseInt(document.getElementById('original-shares').value);
            const tBuyPrice = parseFloat(document.getElementById('t-buy-price').value);
            const tSellPrice = parseFloat(document.getElementById('t-sell-price').value);
            const tShares = parseInt(document.getElementById('t-shares').value);
            
            if (isNaN(originalCost) || isNaN(originalShares) || isNaN(tBuyPrice) || 
                isNaN(tSellPrice) || isNaN(tShares) || originalCost <= 0 || 
                originalShares <= 0 || tBuyPrice <= 0 || tSellPrice <= 0 || 
                tShares <= 0 || originalShares % 100 !== 0 || tShares % 100 !== 0 ||
                tShares > originalShares) {
                alert('请输入有效的数据，做T数量不能超过原有持仓数量，且应为100的倍数');
                return;
            }
            
            // 计算做T买入成本
            const tBuyTotal = tBuyPrice * tShares;
            let tBuyCommission = tBuyTotal * getCommissionRate();
            tBuyCommission = Math.max(tBuyCommission, getMinCommission());
            
            let tBuyTransferFee = 0;
            if (market === 'sh') { // 深市无过户费
                if (type === 'stock') {
                    tBuyTransferFee = tBuyTotal * STOCK_TRANSFER_RATE;
                } else { // ETF
                    tBuyTransferFee = tShares * ETF_TRANSFER_FEE_PER_SHARE;
                }
            }
            
            const tBuyCost = tBuyTotal + tBuyCommission + tBuyTransferFee;
            
            // 计算做T卖出收入
            const tSellTotal = tSellPrice * tShares;
            let tSellCommission = tSellTotal * getCommissionRate();
            tSellCommission = Math.max(tSellCommission, getMinCommission());
            
            // 股票卖出有印花税，ETF没有
            const tSellStampDuty = type === 'stock' ? tSellTotal * STAMP_DUTY_RATE : 0;
            
            let tSellTransferFee = 0;
            if (market === 'sh') { // 深市无过户费
                if (type === 'stock') {
                    tSellTransferFee = tSellTotal * STOCK_TRANSFER_RATE;
                } else { // ETF
                    tSellTransferFee = tShares * ETF_TRANSFER_FEE_PER_SHARE;
                }
            }
            
            const tSellIncome = tSellTotal - tSellCommission - tSellStampDuty - tSellTransferFee;
            
            // 计算做T收益
            const tTransactionFees = tBuyCommission + tBuyTransferFee + tSellCommission + tSellStampDuty + tSellTransferFee;
            const tProfit = tSellIncome - tBuyCost;
            
            // 计算做T后的成本价
            const originalTotalCost = originalCost * originalShares;
            const newTotalCost = originalTotalCost + tBuyCost - tSellIncome;
            const postTCost = newTotalCost / originalShares;
            
            // 显示结果
            document.getElementById('t-buy-total').textContent = formatCurrency(tBuyTotal);
            document.getElementById('t-buy-commission').textContent = formatCurrency(tBuyCommission);
            document.getElementById('t-buy-transfer').textContent = formatCurrency(tBuyTransferFee);
            document.getElementById('t-buy-cost').textContent = formatCurrency(tBuyCost);
            
            document.getElementById('t-sell-total').textContent = formatCurrency(tSellTotal);
            document.getElementById('t-sell-commission').textContent = formatCurrency(tSellCommission);
            document.getElementById('t-stamp-duty').textContent = formatCurrency(tSellStampDuty);
            document.getElementById('t-sell-transfer').textContent = formatCurrency(tSellTransferFee);
            document.getElementById('t-sell-income').textContent = formatCurrency(tSellIncome);
            
            document.getElementById('t-transaction-fees').textContent = formatCurrency(tTransactionFees);
            
            // 显示做T获利
            const tProfitElement = document.getElementById('t-profit');
            tProfitElement.textContent = formatCurrency(tProfit);
            if (tProfit >= 0) {
                tProfitElement.className = 'font-semibold text-success';
            } else {
                tProfitElement.className = 'font-semibold text-danger';
            }
            
            // 显示成本价变化
            document.getElementById('pre-t-cost').textContent = originalCost.toFixed(4) + '元';
            document.getElementById('post-t-cost').textContent = postTCost.toFixed(4) + '元';
            
            // 添加动画效果
            animateResults('t-results');
        });

        // 计算做T回本：根据每轮T的买卖，估算回本所需轮数（支持高级策略）
        document.getElementById('calculate-tbe').addEventListener('click', () => {
            const type = getSelectedType('tbe');
            const market = getSelectedMarket('tbe');
            const originalCost = parseFloat(document.getElementById('tbe-original-cost').value);
            const originalShares = parseInt(document.getElementById('tbe-original-shares').value);
            const currentPrice = parseFloat(document.getElementById('tbe-current-price').value);
            const buyPrice = parseFloat(document.getElementById('tbe-buy-price').value);
            const sellPrice = parseFloat(document.getElementById('tbe-sell-price').value);
            const tShares = parseInt(document.getElementById('tbe-shares').value);

            if ([originalCost, currentPrice, buyPrice, sellPrice].some(v => isNaN(v) || v <= 0) ||
                [originalShares, tShares].some(v => isNaN(v) || v <= 0 || v % 100 !== 0)) {
                alert('请输入有效的数据（数量为100的倍数，价格>0）');
                return;
            }

            const originalTotal = originalCost * originalShares;
            const currentValue = currentPrice * originalShares;
            const lossToCover = Math.max(0, originalTotal - currentValue);

            // 读取高级策略参数
            const advEnabled = document.getElementById('tbe-adv-enabled')?.checked;
            const qtyMode = document.getElementById('tbe-qty-mode')?.value || 'fixed';
            const maxRoundsInput = parseInt(document.getElementById('tbe-adv-max-rounds')?.value || '0');
            const buySlip = parseFloat(document.getElementById('tbe-adv-buy-slip')?.value || '0');
            const sellSlip = parseFloat(document.getElementById('tbe-adv-sell-slip')?.value || '0');
            const buyStep = parseFloat(document.getElementById('tbe-adv-buy-step')?.value || '0');
            const sellStep = parseFloat(document.getElementById('tbe-adv-sell-step')?.value || '0');
            const inc = parseInt(document.getElementById('tbe-adv-inc')?.value || '0');
            const minQty = parseInt(document.getElementById('tbe-adv-min')?.value || '0');
            const maxQty = parseInt(document.getElementById('tbe-adv-max')?.value || '0');
            const incPct = parseFloat(document.getElementById('tbe-adv-inc-pct')?.value || '0');
            const minQtyPct = parseInt(document.getElementById('tbe-adv-min-pct')?.value || '0');
            const maxQtyPct = parseInt(document.getElementById('tbe-adv-max-pct')?.value || '0');

            // 迭代模拟
            let remaining = lossToCover;
            let rounds = 0;
            let totalProfit = 0;
            let totalFees = 0;
            let lastStampDuty = 0;
            let firstRoundProfit = 0;

            let shares = tShares;
            let buyR = buyPrice;
            let sellR = sellPrice;

            const applyClampToHundreds = (value) => {
                if (!isFinite(value) || value <= 0) return 0;
                return Math.max(0, Math.round(value / 100) * 100);
            };

            const getNextShares = (currentShares) => {
                if (!advEnabled) return currentShares;
                let next = currentShares;
                if (qtyMode === 'inc') next = currentShares + (isNaN(inc) ? 0 : inc);
                if (qtyMode === 'dec') next = currentShares - (isNaN(inc) ? 0 : inc);
                if (qtyMode === 'incPct') next = Math.floor(currentShares * (1 + (isNaN(incPct) ? 0 : incPct) / 100));
                if (qtyMode === 'decPct') next = Math.floor(currentShares * (1 - (isNaN(incPct) ? 0 : incPct) / 100));

                // 约束上下限（优先使用与模式对应的min/max）
                if (qtyMode === 'inc' || qtyMode === 'dec') {
                    if (!isNaN(minQty) && minQty > 0) next = Math.max(next, minQty);
                    if (!isNaN(maxQty) && maxQty > 0) next = Math.min(next, maxQty);
                } else if (qtyMode === 'incPct' || qtyMode === 'decPct') {
                    if (!isNaN(minQtyPct) && minQtyPct > 0) next = Math.max(next, minQtyPct);
                    if (!isNaN(maxQtyPct) && maxQtyPct > 0) next = Math.min(next, maxQtyPct);
                }

                next = applyClampToHundreds(next);
                if (next < 100) next = 100;
                return next;
            };

            const maxRounds = advEnabled && maxRoundsInput > 0 ? maxRoundsInput : Math.ceil(lossToCover / 0.01) + 1; // 合理的安全上限

            while (remaining > 0 && rounds < maxRounds) {
                const effBuy = Math.max(0.001, buyR + (isNaN(buySlip) ? 0 : buySlip));
                const effSell = Math.max(0.001, sellR - (isNaN(sellSlip) ? 0 : sellSlip));

                const buyTotal = effBuy * shares;
                let buyCommission = buyTotal * getCommissionRate();
                buyCommission = Math.max(buyCommission, getMinCommission());
                let buyTransfer = 0;
                if (market === 'sh') {
                    buyTransfer = type === 'stock' ? (buyTotal * STOCK_TRANSFER_RATE) : (shares * ETF_TRANSFER_FEE_PER_SHARE);
                }

                const sellTotal = effSell * shares;
                let sellCommission = sellTotal * getCommissionRate();
                sellCommission = Math.max(sellCommission, getMinCommission());
                const stampDuty = (type === 'stock') ? (sellTotal * STAMP_DUTY_RATE) : 0;
                let sellTransfer = 0;
                if (market === 'sh') {
                    sellTransfer = type === 'stock' ? (sellTotal * STOCK_TRANSFER_RATE) : (shares * ETF_TRANSFER_FEE_PER_SHARE);
                }

                const fees = buyCommission + buyTransfer + sellCommission + stampDuty + sellTransfer;
                const income = sellTotal - sellCommission - stampDuty - sellTransfer;
                const cost = buyTotal + buyCommission + buyTransfer;
                const profit = income - cost;

                if (rounds === 0) firstRoundProfit = profit;

                // 若本轮净收益<=0，提前终止，避免死循环
                if (profit <= 0) {
                    totalFees += fees;
                    lastStampDuty = stampDuty;
                    break;
                }

                totalProfit += profit;
                totalFees += fees;
                lastStampDuty = stampDuty;
                remaining -= profit;
                rounds += 1;

                // 下一轮参数更新
                shares = getNextShares(shares);
                buyR = Math.max(0.001, buyR - (isNaN(buyStep) ? 0 : buyStep));
                sellR = Math.max(0.001, sellR + (isNaN(sellStep) ? 0 : sellStep));
            }

            const avgProfitPerRound = rounds > 0 ? (totalProfit / rounds) : firstRoundProfit;
            const postCost = (originalTotal - totalProfit) / originalShares;

            // 输出
            document.getElementById('tbe-original-total').textContent = formatCurrency(originalTotal);
            document.getElementById('tbe-current-value').textContent = formatCurrency(currentValue);
            document.getElementById('tbe-loss-to-cover').textContent = formatCurrency(lossToCover);
            document.getElementById('tbe-profit-per-round').textContent = formatCurrency(avgProfitPerRound || 0);
            document.getElementById('tbe-rounds').textContent = (remaining > 0 && advEnabled && maxRoundsInput > 0 && rounds >= maxRounds)
                ? `${rounds} 轮（达最大轮数仍未回本）`
                : `${rounds} 轮`;
            document.getElementById('tbe-total-profit').textContent = formatCurrency(totalProfit);
            document.getElementById('tbe-total-fees').textContent = formatCurrency(totalFees);
            document.getElementById('tbe-stamp-duty-per-round').textContent = formatCurrency(lastStampDuty);
            document.getElementById('tbe-post-cost').textContent = postCost.toFixed(4) + '元';

            // 颜色强调
            const lossEl = document.getElementById('tbe-loss-to-cover');
            lossEl.className = lossToCover > 0 ? 'font-medium text-danger' : 'font-medium text-success';

            animateResults('tbe-results');
        });

        // ===== 行情盈亏：代码/名称 -> 最新价（Sina JSONP）=====
        // JSONP加载器（支持GBK）
        function loadScriptJsonp(src, { charset = 'utf-8' } = {}) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.charset = charset;
                script.async = true;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Script load error'));
                document.body.appendChild(script);
                // 超时保护
                setTimeout(() => {
                    try { document.body.removeChild(script); } catch(e) {}
                }, 8000);
            });
        }

        // 解析市场与标准symbol
        function detectMarketFromCode(code) {
            const c = (code || '').trim();
            if (c.startsWith('sh') || c.startsWith('SH')) return 'sh';
            if (c.startsWith('sz') || c.startsWith('SZ')) return 'sz';
            if (/^\d{6}$/.test(c)) {
                return c.startsWith('6') ? 'sh' : 'sz';
            }
            return 'sh';
        }

        function normalizeSymbol(input) {
            const s = (input || '').trim();
            if (!s) return null;
            if (/^(sh|sz)\d{6}$/i.test(s)) return s.toLowerCase();
            const digits = s.match(/\d{6}/);
            if (digits) {
                const code = digits[0];
                return detectMarketFromCode(code) + code;
            }
            return null;
        }

        // 拉取最新价（Sina hq）
        async function fetchLatestQuoteSina(symbol) {
            const key = 'hq_str_' + symbol;
            try { delete window[key]; } catch(e) {}
            await loadScriptJsonp(`https://hq.sinajs.cn/list=${symbol}`, { charset: 'gbk' });
            const raw = window[key];
            if (!raw || typeof raw !== 'string') throw new Error('无行情数据');
            const parts = raw.split(',');
            // Sina字段：0名称,1今开,2昨收,3最新,4最高,5最低,...
            const name = parts[0] || '';
            const prevClose = parseFloat(parts[2] || '0');
            const last = parseFloat(parts[3] || '0');
            const time = parts[30] && parts[31] ? (parts[30] + ' ' + parts[31]) : '';
            return { name, prevClose, last, time };
        }

        // 拉取最新价（Tencent qt.gtimg.cn）
        async function fetchLatestQuoteTencent(symbol) {
            // 腾讯不区分大小写，但统一小写更稳妥
            const sym = symbol.toLowerCase();
            const key = 'v_' + sym;
            try { delete window[key]; } catch(e) {}
            await loadScriptJsonp(`https://qt.gtimg.cn/q=${sym}`, { charset: 'gbk' });
            const raw = window[key];
            if (!raw || typeof raw !== 'string') throw new Error('无行情数据');
            // 形如：v_sh600000="1~浦发银行~600000~10.10~10.20~10.00~..."
            const body = raw.replace(/^.*?=\"/, '').replace(/\";?$/, '');
            const arr = body.split('~');
            const name = arr[1] || '';
            const last = parseFloat(arr[3] || '0');
            const prevClose = parseFloat(arr[4] || '0');
            const time = '';
            if (!isFinite(last) || !isFinite(prevClose)) throw new Error('解析失败');
            return { name, prevClose, last, time };
        }

        async function fetchLatestQuote(symbol) {
            try {
                const q = await fetchLatestQuoteSina(symbol);
                if (isFinite(q.last) && q.last > 0) return q;
                // 回退
                return await fetchLatestQuoteTencent(symbol);
            } catch(e) {
                // 回退
                return await fetchLatestQuoteTencent(symbol);
            }
        }

        // 名称/代码联想（Sina suggest）
        let suggestTimer = null;
        const suggestBox = document.getElementById('rt-suggest');
        const symbolInput = document.getElementById('rt-symbol');

        async function fetchSuggest(query) {
            try { delete window.suggestvalue; } catch(e) {}
            await loadScriptJsonp(`https://suggest3.sinajs.cn/suggest/type=11,12,13,14,15&key=${encodeURIComponent(query)}`, { charset: 'gbk' });
            const txt = window.suggestvalue || '';
            // 返回以 ; 分隔多条, 每条以 , 分隔字段，常见第5项为完整symbol（shXXXXXX/szXXXXXX）
            const items = txt.split(';').map(s => s.trim()).filter(Boolean).map(row => row.split(','));
            const mapped = items.map(arr => {
                const code = (arr[0] || '').trim();
                const name = (arr[1] || '').trim();
                const full = (arr[4] || '').trim();
                const symbol = /^(sh|sz)\d{6}$/i.test(full) ? full.toLowerCase() : (code && /^\d{6}$/.test(code) ? (detectMarketFromCode(code) + code) : '');
                return { name, code, symbol };
            }).filter(x => x.symbol);
            return mapped.slice(0, 10);
        }

        function renderSuggest(list) {
            if (!list.length) { suggestBox.classList.add('hidden'); suggestBox.innerHTML=''; return; }
            suggestBox.innerHTML = list.map(i => `
                <div class="px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm" data-symbol="${i.symbol}" data-name="${i.name}" data-code="${i.code}">
                    <span class="font-medium mr-2">${i.name}</span><span class="text-gray-500">${i.code.toUpperCase()} · ${i.symbol.toUpperCase()}</span>
                </div>
            `).join('');
            suggestBox.classList.remove('hidden');
        }

        symbolInput.addEventListener('input', () => {
            const q = symbolInput.value.trim();
            if (!q) { suggestBox.classList.add('hidden'); suggestBox.innerHTML=''; return; }
            clearTimeout(suggestTimer);
            suggestTimer = setTimeout(async () => {
                try {
                    // 若纯数字并长度>=3，直接展示基于代码的猜测
                    if (/^\d{3,}$/.test(q)) {
                        const code = q.padEnd(6, '0').slice(0, 6);
                        renderSuggest([{ name: '代码匹配', code, symbol: (detectMarketFromCode(code) + code) }]);
                        return;
                    }
                    const list = await fetchSuggest(q);
                    renderSuggest(list);
                } catch(e) {
                    suggestBox.classList.add('hidden');
                }
            }, 250);
        });

        suggestBox.addEventListener('click', (e) => {
            const item = e.target.closest('[data-symbol]');
            if (!item) return;
            const nm = item.getAttribute('data-name');
            const cd = item.getAttribute('data-code');
            const sym = item.getAttribute('data-symbol');
            symbolInput.value = `${cd} ${nm}`;
            suggestBox.classList.add('hidden');
            symbolInput.setAttribute('data-picked-symbol', sym);
        });

        // 计算行情盈亏
        document.getElementById('calculate-rtpl').addEventListener('click', async () => {
            const type = getSelectedType('rt');
            const cost = parseFloat(document.getElementById('rt-cost').value);
            const shares = parseInt(document.getElementById('rt-shares').value);
            const inputRaw = symbolInput.value.trim();
            let symbol = symbolInput.getAttribute('data-picked-symbol') || normalizeSymbol(inputRaw);

            if (isNaN(cost) || isNaN(shares) || cost <= 0 || shares <= 0 || shares % 100 !== 0) {
                alert('请输入有效的持仓成本与数量（数量为100的倍数）');
                return;
            }
            if (!symbol) {
                // 未选择联想项时，尝试用联想接口自动匹配第一条
                try {
                    const list = await fetchSuggest(inputRaw);
                    if (list && list.length > 0) {
                        symbol = list[0].symbol;
                        symbolInput.setAttribute('data-picked-symbol', symbol);
                    }
                } catch(e) {}
                if (!symbol) {
                    alert('未匹配到有效标的。可输入代码（如 600000／sz000001）或名称后从联想中选择。');
                    return;
                }
            }

            try {
                const quote = await fetchLatestQuote(symbol);
                const market = detectMarketFromCode(symbol);
                const totalValue = quote.last * shares;
                let commission = totalValue * getCommissionRate();
                commission = Math.max(commission, getMinCommission());
                const stamp = (type === 'stock') ? (totalValue * STAMP_DUTY_RATE) : 0;
                let transfer = 0;
                if (market === 'sh') {
                    transfer = (type === 'stock') ? (totalValue * STOCK_TRANSFER_RATE) : (shares * ETF_TRANSFER_FEE_PER_SHARE);
                }
                const actual = totalValue - commission - stamp - transfer;
                const orig = cost * shares;
                const net = actual - orig;
                const rate = net / orig;

                document.getElementById('rtpl-info').textContent = `${quote.name || ''} ${symbol.toUpperCase()} ${quote.time || ''}`.trim();
                document.getElementById('rtpl-last').textContent = isFinite(quote.last) ? formatCurrency(quote.last) : '- -';
                document.getElementById('rtpl-prev').textContent = isFinite(quote.prevClose) ? formatCurrency(quote.prevClose) : '- -';
                const chgPct = (isFinite(quote.last) && isFinite(quote.prevClose) && quote.prevClose > 0) ? ((quote.last - quote.prevClose) / quote.prevClose) : NaN;
                document.getElementById('rtpl-chg').textContent = isFinite(chgPct) ? formatPercentage(chgPct) : '- -';
                document.getElementById('rtpl-commission').textContent = formatCurrency(commission);
                document.getElementById('rtpl-stamp').textContent = formatCurrency(stamp);
                document.getElementById('rtpl-transfer').textContent = formatCurrency(transfer);
                document.getElementById('rtpl-actual').textContent = formatCurrency(actual);
                document.getElementById('rtpl-orig').textContent = formatCurrency(orig);
                const netEl = document.getElementById('rtpl-net');
                netEl.textContent = formatCurrency(net);
                netEl.className = net >= 0 ? 'font-semibold text-success' : 'font-semibold text-danger';
                const rateEl = document.getElementById('rtpl-rate');
                rateEl.textContent = formatPercentage(rate);
                rateEl.className = rate >= 0 ? 'font-semibold text-success' : 'font-semibold text-danger';

                // ETF不显示印花税
                const stampBox = document.getElementById('rtpl-stamp-duty-container');
                stampBox.style.display = (type === 'stock') ? 'flex' : 'none';

                animateResults('rtpl-results');
            } catch(err) {
                alert('获取行情失败，请检查代码/网络后重试');
            }
        });
        
        // 结果区域动画效果
        function animateResults(elementId) {
            const resultsElement = document.getElementById(elementId);
            resultsElement.classList.add('opacity-0');
            
            setTimeout(() => {
                resultsElement.classList.remove('opacity-0');
                resultsElement.classList.add('transition-opacity', 'duration-500');
            }, 50);
        }
        
        // 输入框回车键触发计算
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    // 根据当前活跃的选项卡触发相应的计算
                    if (!document.getElementById('buy-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-buy').click();
                    } else if (!document.getElementById('sell-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-sell').click();
                    } else if (!document.getElementById('profit-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-profit').click();
                    } else if (!document.getElementById('etf-profit-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-etf-profit').click();
                    } else if (!document.getElementById('t-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-t').click();
                    } else if (!document.getElementById('tbe-calculator').classList.contains('hidden')) {
                        document.getElementById('calculate-tbe').click();
                    }
                }
            });
        });
    </script>
</body>
</html>

StockTransactionCostCalculator
